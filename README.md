# Домашнее задание №1. Поиск дублирующихся изображений

# Отчет о проделанной работе
###### Команда #1 (Никитина Алина, Овчинникова Юлия, Горохова Александра)  

### **Описание данных**
---
### **Train**

- 456 изображений в папке `public_data/train`
- 136 изображений в папке `public_data/test`

### **Test**

- 827 изображений в папке `data/train`
- 328 изображений в папке `data/test`

---
### **Скрипты**

- `main_predict_on_public_data.py` - предсказания лишних изображений для `public_data`.
- `main_predict_on_data.py` - предсказания лишних изображений для `data`.
- `sripts` - папка со скриптами для различных методов.
- `metrics` - папка с метриками.
- `logs` - папка с логами.
- `utils` - папка с вспомогательными функциями.
- `output` - папка с результатами предсказаний.

---

### **1. Определение лишних изображений в тестовой части датасета.**

### **Цель работы**
- Определить лишние изображения в тестовой выборке, которые уже есть в тренировочной.
- Оценить точность через `F1-score`.
- Достичь метрики `F1-score > 0.81`.
- Оптимизировать время выполнения алгоритма до `15 минут`.
---

### **Эксперименты на данных public_data**
---
### 1. Хэш-методы (pHash, dHash)
Позволяют быстро сравнивать изображения с помощью хэшей. Используют для сравнения расстояние Хэмминга. Устойчивы к мелким искажениям, но чувствительны к кадрированию.

- **pHash (Perceptual Hash)** — вычисляет хэш на основе низкочастотных компонентов изображения.

Лучшая метрика F1-score — 0.7708 с порогом 15. Было применено кэширование хэшей, что позволило значительно сократить время вычислений [06:00 --> 00:07 (7.84486s)].

```
-------------------1. Метод pHash (Perceptual Hash)-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [00:07<00:00, 17.36it/s]
Количество лишних изображений согласно предсказаниям: 37
Время выполнения: 00:07 | в миллисекундах: 7.84486s (7844 ms)
        Presicion: 1.0000
        Recall: 0.6271
        F1-score: 0.7708
```

- **dHash (Difference Hash)** — хэш строится на разнице между соседними пикселями.

Лучшая метрика F1-score — 0.7879 с порогом 15 и кэшированием хэшей [время выполнения 00:08 (8.57934s)].

```
-------------------2. Метод dHash (Difference Hash)-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [00:08<00:00, 15.86it/s]
Количество лишних изображений согласно предсказаниям: 40
Время выполнения: 00:08 | в миллисекундах: 8.57934s (8579 ms)
        Presicion: 0.9750
        Recall: 0.6610
        F1-score: 0.7879
```

Оптимизированный вариант метода `dHash` позволил повысить метрику F1-score до 0.8037 с порогом 15 [время выполнения 00:07 (7.92582s)].

```
-------------------3. Метод Fast dHash-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [00:07<00:00, 17.17it/s]
Количество лишних изображений согласно предсказаниям: 48
Время выполнения: 00:07 | в миллисекундах: 7.92582s (7925 ms)
        Presicion: 0.8958
        Recall: 0.7288
        F1-score: 0.8037
```

---

### 2. SSIM (Structural Similarity Index)

Метод оценивает структурное сходство изображений, хорошо работает при мелких изменениях, но медленный и не подходит для поворотов или частичных совпадений.

Лучшая метрика F1-score — 0.6337 с порогом 0.2 и размером изображения 64х64. Увеличения скорости вычислений можно добиться уменьшением размера изображения или снижением порога, но качество будет ниже.

```
-------------------4. Метод SSIM-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Загрузка тренировочных изображений...
Загрузка тестовых изображений...
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [01:07<00:00,  2.00it/s]
Количество лишних изображений согласно предсказаниям: 42
Время выполнения: 01:10 | в миллисекундах: 70.52882s (70528 ms)
        Presicion: 0.7619
        Recall: 0.5424
        F1-score: 0.6337
```

---

### 3. Histogram (Сравнение цветовых гистограмм)

Метод анализирует распределение цвета, причем можно проверять разные цветовые пространства (HSV/RGB/YUV). Работает очень быстро, но игнорирует пространственную информацию, форму и структуру. При этом качество выше чем у хэшей.

Лучшая метрика F1-score — 0.8760 с порогом 0.85 и размером изображения 64х64. Для сравнения используется метрика корреляции в цветовом пространстве HSV.
Из методов сравнения также были испробованы интерсект и хи-квадрат; цветовые пространства RGB и YUV. Время выполнения — 00:03 (3.61578s).

```
-------------------5. Метод Histogram-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Расчет гистограмм для тренировочных изображений...
Расчет гистограмм для тестовых изображений...
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [00:00<00:00, 1534.86it/s]
Количество лишних изображений согласно предсказаниям: 62
Время выполнения: 00:03 | в миллисекундах: 3.61578s (3615 ms)
        Presicion: 0.8548
        Recall: 0.8983
        F1-score: 0.8760
```

---

### 4. Методы ORB / SIFT

Методы детектируют ключевые точки и их дескрипторы.

- **ORB (Oriented FAST and Rotated BRIEF)** — устойчив к поворотам и масштабированию, хорошо справляется с аугментациями.

Показал самые высокие метрики (F1-score — 0.9273) при пороге 40 и размере изображения 128x128. Работает достаточно быстро. Время выполнения — 00:29 (29.52776s).

```
-------------------6. Метод ORB-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Загрузка тренировочных изображений...
Загрузка изображений: 100%|█████████████████████████████| 456/456 [00:01<00:00, 237.18it/s]
Загрузка тестовых изображений...
Загрузка изображений: 100%|█████████████████████████████| 136/136 [00:00<00:00, 186.87it/s]
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [00:26<00:00,  5.06it/s]
Количество лишних изображений согласно предсказаниям: 51
Время выполнения: 00:29 | в миллисекундах: 29.52776s (29527 ms)
        Presicion: 1.0000
        Recall: 0.8644
        F1-score: 0.9273
```

- **SIFT (Scale-Invariant Feature Transform)** — метод устойчив к ракурсу и масштабу.

Очень медленный метод и показывает не слишком хорошую точность (F1-score — 0.6051). Время выполнения — 07:08 (428.15262s).

```
-------------------7. Метод SIFT-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Загрузка дескрипторов SIFT для тренировочных изображений...
100%|█████████████████████████████| 456/456 [01:44<00:00,  4.36it/s]
Загрузка дескрипторов SIFT для тестовых изображений...
100%|█████████████████████████████| 136/136 [00:37<00:00,  3.64it/s]
Обработка тестовых изображений: 100%|█████████████████████████████| 136/136 [04:46<00:00,  2.11s/it]
Количество лишних изображений согласно предсказаниям: 136
Время выполнения: 07:08 | в миллисекундах: 428.15262s (428152 ms)
        Presicion: 0.4338
        Recall: 1.0000
        F1-score: 0.6051
```

---

### 5. Нейронные сети

С помощью нейросетевых методов можно извлекать признаки из изображений (эмбеддинги) и сравнивать их с помощью cosine similarity. Это позволяет находить похожие изображения даже с аугментациями. Ускорение работы можно получить с помощью GPU (работают очень быстро).

- **ResNet50**

Лучший результат F1-score — 0.8906 при пороге 0.75 и размере изображений 224x224. Время выполнения — 00:11 (11.72783s).

```
------------------8. ResNet50-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Создание эмбеддингов для тренировочных изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 456/456 [00:07<00:00, 59.41it/s]
Создание эмбеддингов для тестовых изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 136/136 [00:02<00:00, 46.82it/s]
Поиск совпадений: 100%|█████████████████████████████| 136/136 [00:00<00:00, 485.69it/s]
Количество лишних изображений согласно предсказаниям: 69
Время выполнения: 00:11 | в миллисекундах: 11.72783s (11727 ms)
        Presicion: 0.8261
        Recall: 0.9661
        F1-score: 0.8906
```

- **EfficientNetB4**

Лучший результат F1-score — 0.8485 при пороге 0.75 и размере изображений 380x380. Время выполнения — 00:17 (17.30644s).

```
------------------9. EfficientNet-B4-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Создание эмбеддингов для тренировочных изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 456/456 [00:12<00:00, 36.62it/s]
Создание эмбеддингов для тестовых изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 136/136 [00:04<00:00, 32.50it/s]
Поиск совпадений: 100%|█████████████████████████████| 136/136 [00:00<00:00, 544.31it/s]
Количество лишних изображений согласно предсказаниям: 33
Время выполнения: 00:17 | в миллисекундах: 17.30644s (17306 ms)
        Presicion: 1.0000
        Recall: 0.5593
        F1-score: 0.7174
```

- **ConvNeXt-Tiny**

Лучший результат F1-score — 0.8148 при пороге 0.75 и размере изображений 224x224. Время выполнения — 00:10 (10.20474s).

```
------------------10. ConvNeXt-Tiny-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Создание эмбеддингов для тренировочных изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 456/456 [00:06<00:00, 66.40it/s]
Создание эмбеддингов для тестовых изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 136/136 [00:02<00:00, 49.80it/s]
Поиск совпадений: 100%|█████████████████████████████| 136/136 [00:00<00:00, 1108.55it/s]
Количество лишних изображений согласно предсказаниям: 76
Время выполнения: 00:10 | в миллисекундах: 10.20474s (10204 ms)
        Presicion: 0.7237
        Recall: 0.9322
        F1-score: 0.8148
```

---


### 6. Комбинации методов

Были испробованы разные подходы того, как можно комбинировать методы и взять лучшее от каждого. Например, сложение готовых предсказаний, отбор наиболее частых предсказаний по всем методам, а также комбинация методов ORB и ResNet50, которая и оказалась лучшей.

Часть результатов представлена ниже, остальное доступно в папке `.logs`.

```
--------------11. Комбинации методов (сложение предсказаний)---------------
-------------------FAST_DHASH + HIST + ORB-------------------
Время выполнения в миллисекундах: 41.06937s (41069 ms)
        Presicion: 0.8056
        Recall: 0.9831
        F1-score: 0.8855
-------------------HIST + ORB-------------------
Время выполнения в миллисекундах: 33.14354s (33143 ms)
        Presicion: 0.8657
        Recall: 0.9831
        F1-score: 0.9206
```

---

### 7. Метод ORB + ResNet50

Основан на комбинации методов ORB и ResNet50.

Сначала делается предсказание с помощью метода ORB, затем предсказания вычитаются из тестовых данных и на оставшихся данных делается предсказание с помощью ResNet50. Далее результаты объединяются. 

Такой подход позволил получить F1-score — `0.9649` на тренировочных данных при параметрах: 40 [128x128] для ORB и 0.85 [512x512] для ResNet50. 

Время выполнения — 00:42 (42.46050s).

```
-------------------12. Методы ORB (первоначальная обработка) --> ResNet (дополнительная обработка остальных изображений)-------------------
------------------ResNet50-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество лишних изображений в оригинальной разметке: 59
Создание эмбеддингов для тренировочных изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 456/456 [00:10<00:00, 43.44it/s]
Создание эмбеддингов для тестовых изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 85/85 [00:01<00:00, 44.02it/s]
Поиск совпадений: 100%|█████████████████████████████| 85/85 [00:00<00:00, 484.47it/s]
Количество лишних изображений согласно предсказаниям: 4
Время выполнения: 00:42 | в миллисекундах: 42.46050s (42460 ms)
        Presicion: 1.0000
        Recall: 0.9322
        F1-score: 0.9649
```

---

### **Замеры времени на данных data**

Результаты сореванования на [лидерборде Kaggle](https://www.kaggle.com/competitions/aith-cv-25-hw-1-test-data-cleaning/leaderboard).

1. **Метод Histogram**

Время выполнения — 00:11 (11.81984s).

```
-------------------Метод Histogram-------------------
Найдено 827 изображений в папке `data/train`
Найдено 328 изображений в папке `data/test`
Расчет гистограмм для тренировочных изображений...
Расчет гистограмм для тестовых изображений...
Обработка тестовых изображений: 100%|█████████████████████████████| 328/328 [00:00<00:00, 870.50it/s]
Количество лишних изображений согласно предсказаниям: 156
Ответы успешно сохранены в файл: output/pred_orb_submission.csv
Список изображений успешно сохранен в файл: output/pred_orb_final.txt
Время выполнения: 00:11 | в миллисекундах: 11.81984s (11819 ms)
```

2. **Метод ORB + ResNet50 (лидерборд 0.91)**

Время выполнения — 02:28 (148.17498s).

```
-------------------ORB + ResNet50-------------------
Найдено 827 изображений в папке `data/train`
Найдено 328 изображений в папке `data/test`
Загрузка тренировочных изображений...
Загрузка изображений: 100%|█████████████████████████████| 827/827 [00:04<00:00, 174.41it/s]
Загрузка тестовых изображений...
Загрузка изображений: 100%|█████████████████████████████| 328/328 [00:01<00:00, 248.76it/s]
Обработка тестовых изображений: 100%|█████████████████████████████| 328/328 [01:53<00:00,  2.89it/s]
Количество лишних изображений согласно предсказаниям: 100
Создание эмбеддингов для тренировочных изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 827/827 [00:22<00:00, 37.44it/s]
Создание эмбеддингов для тестовых изображений...
Вычисление эмбеддингов: 100%|█████████████████████████████| 228/228 [00:04<00:00, 50.25it/s]
Поиск совпадений: 100%|█████████████████████████████| 228/228 [00:00<00:00, 238.64it/s]
Количество лишних изображений согласно предсказаниям: 26
Ответы успешно сохранены в файл: output/pred_orb_resnet_submission.csv
Список изображений успешно сохранен в файл: output/pred_orb_resnet_final.txt
Время выполнения: 02:28 | в миллисекундах: 148.17498s (148174 ms)
```

![alt text](assets/image.png)

3. **Метод ORB (лидерборд 0.93)**

Применение чистого метода ORB дало результат чуть выше, чем комбинация с нейросетью.

Время выполнения — 01:57 (117.15128s).

```
-------------------Метод ORB-------------------
Найдено 827 изображений в папке `data/train`
Найдено 328 изображений в папке `data/test`
Загрузка тренировочных изображений...
Загрузка изображений: 100%|█████████████████████████████| 827/827 [00:04<00:00, 175.30it/s]
Загрузка тестовых изображений...
Загрузка изображений: 100%|█████████████████████████████| 328/328 [00:01<00:00, 248.36it/s]
Обработка тестовых изображений: 100%|█████████████████████████████| 328/328 [01:51<00:00,  2.95it/s]
Количество лишних изображений согласно предсказаниям: 100
Ответы успешно сохранены в файл: output/pred_orb_submission.csv
Список изображений успешно сохранен в файл: output/pred_orb_final.txt
Время выполнения: 01:57 | в миллисекундах: 117.15128s (117151 ms)
```

![alt text](assets/image_1.png)

---
Таким образом лучшим методом для выявления похожих изображений является метод 🏆 ORB 🏆.

---

### **2. Разбиение датасета на группы так, чтобы каждая группа содержала только аугментированные варианты одного и того же исходного изображения.**

### **Цель работы**
- Для всех изображений вычислить признаковое представление: хэш, дескриптор или эмбеддинг.
- Вычислить матрицу сходства / расстояний.
- Применить кластеризацию или группировку по порогу.
- Оценить долю правильно восстановленных групп.
- Достичь метрики `> 6%` полностью правильно собранных групп.
- Оптимизировать время выполнения алгоритма до `15 минут`.
---

### **Эксперименты на данных public_data**
---
### 1. ORB

Подход основан на сравнении изображений попарно с использованием дескрипторов ORB и затем кластеризации путем построения графа связей между изображениями по факту их сходства.

Результаты:
- Точное совпадение групп — 0.0192
- Время выполнения — 00:59 (59.52573s)

Вычисленное сходство с помощью ORB в данной задаче является недостаточным, поэтому в итоговой группировке оказалось много одиночных изображений, которые не были отнесены ни к одной группе. 

```
-------------------1. Метод ORB + Graph-based clustering-------------------
Найдено 456 изображений в папке `public_data/train`
Найдено 136 изображений в папке `public_data/test`
Количество групп: 52
Загрузка тренировочных изображений...
Загрузка изображений: 100%|█████████████████████████████| 456/456 [00:00<00:00, 6218.53it/s]
Группировка изображений с использованием ORB...
Параллельное сравнение: 100%|█████████████████████████████| 103740/103740 [00:57<00:00, 1789.11it/s]
Совпавшие группы: 
{'000134.jpg', '000442.jpg'}
Точное совпадение групп: 0.019230769230769232
Частичное совпадение групп: 3.326923076923077
Время выполнения: 00:59 | в миллисекундах: 59.52573s (59525 ms)
```

---

### 2. ORB + BoVW

В данном эксперименте использовалась комбинация признаков ORB и гистограм визуальных слов (BoVW) для улучшения качества кластеризации.

Также были протестированы различные методы кластеризации: KMeans и Agglomerative Clustering.

Важно отметить, что качество кластеризации сильно зависит от выбранного количества кластеров. В случае работы с тестовыми данными было задано количество кластеров, равным количеству групп в ground truth.


- **KMeans**

Алгоритм кластеризации, направленный на разбиение множества объектов на K-непересекающихся кластеров, где каждый объект относится к кластеру с ближайшим центроидом.

Результаты:
- Точное совпадение групп — 0.0384
- Время выполнения — 00:34 (34.63277s)

```
-------------------2. Кластеризация с помощью K-Means и ORB (BoVW)-------------------
Количество групп: 52
Извлечение дескрипторов для BoVW: 100%|█████████████████████████████| 456/456 [00:06<00:00, 73.37it/s]
Создание гистограмм BoVW: 100%|█████████████████████████████| 456/456 [00:06<00:00, 71.25it/s]
Совпавшие группы: 
{'000123.jpg', '000436.jpg', '000357.jpg', '000147.jpg', '000350.jpg', '000450.jpg', '000077.jpg'}
{'000244.jpg', '000521.jpg'}
Точное совпадение групп: 0.038461538461538464
Частичное совпадение групп: 0.5961538461538461
Время выполнения: 00:34 | в миллисекундах: 34.63277s (34632 ms)
```

---
- **Agglomerative Clustering**

Иерархический алгоритм кластеризации, который последовательно объединяет наиболее похожие объекты или кластеры, формируя древовидную структуру (дендрограмму).

Результаты:
- Точное совпадение групп — 0.0769 / 0.0577 (linkage='ward' / 'average')
- Время выполнения — 00:37 (37.29362s) / 00:36 (36.63525s)

```
-------------------3. Кластеризация с помощью Agglomerative Clustering и ORB (BoVW)-------------------
Количество групп: 52
Извлечение дескрипторов для BoVW: 100%|█████████████████████████████| 456/456 [00:08<00:00, 54.65it/s]
Создание гистограмм BoVW: 100%|█████████████████████████████| 456/456 [00:08<00:00, 53.47it/s]
Совпавшие группы: 
{'000007.jpg', '000413.jpg', '000399.jpg', '000498.jpg', '000539.jpg', '000288.jpg', '000091.jpg', '000050.jpg', '000517.jpg', '000215.jpg', '000500.jpg', '000240.jpg', '000267.jpg', '000420.jpg', '000306.jpg', '000512.jpg'}
{'000123.jpg', '000436.jpg', '000357.jpg', '000147.jpg', '000350.jpg', '000450.jpg', '000077.jpg'}
{'000100.jpg', '000150.jpg', '000272.jpg', '000423.jpg', '000245.jpg'}
{'000244.jpg', '000521.jpg'}
Точное совпадение групп: 0.07692307692307693
Частичное совпадение групп: 0.5961538461538461
Время выполнения: 00:37 | в миллисекундах: 37.29362s (37293 ms)
```

```
-------------------4. Кластеризация с помощью Agglomerative Clustering (average linkage) и ORB (BoVW)-------------------
Количество групп: 52
Извлечение дескрипторов для BoVW: 100%|█████████████████████████████| 456/456 [00:08<00:00, 52.44it/s]
Создание гистограмм BoVW: 100%|█████████████████████████████| 456/456 [00:08<00:00, 53.67it/s]
Совпавшие группы: 
{'000123.jpg', '000436.jpg', '000357.jpg', '000147.jpg', '000350.jpg', '000450.jpg', '000077.jpg'}
{'000100.jpg', '000150.jpg', '000272.jpg', '000423.jpg', '000245.jpg'}
{'000244.jpg', '000521.jpg'}
Точное совпадение групп: 0.057692307692307696
Частичное совпадение групп: 0.7115384615384616
Время выполнения: 00:36 | в миллисекундах: 36.63525s (36635 ms)
```

---

### 3. ResNet

В этой серии экспериментов использовалась модель ResNet50 для извлечения признаков изображений.

- **ResNet + K-Means**

Результаты:
- Точное совпадение групп — 0.0962
- Время выполнения — 00:10 (10.79726s)


```
-------------------5. Кластеризация с помощью K-Means и ResNet-------------------
Количество групп: 52
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 15/15 [00:07<00:00,  1.91it/s]
Совпавшие группы: 
{'000468.jpg', '000360.jpg', '000239.jpg', '000580.jpg', '000558.jpg', '000223.jpg', '000408.jpg', '000457.jpg', '000048.jpg', '000439.jpg', '000172.jpg', '000333.jpg', '000480.jpg', '000325.jpg'}
{'000007.jpg', '000413.jpg', '000399.jpg', '000498.jpg', '000539.jpg', '000288.jpg', '000091.jpg', '000050.jpg', '000517.jpg', '000215.jpg', '000500.jpg', '000240.jpg', '000267.jpg', '000420.jpg', '000306.jpg', '000512.jpg'}
{'000123.jpg', '000436.jpg', '000357.jpg', '000147.jpg', '000350.jpg', '000450.jpg', '000077.jpg'}
{'000365.jpg', '000218.jpg', '000318.jpg'}
{'000100.jpg', '000150.jpg', '000272.jpg', '000423.jpg', '000245.jpg'}
Точное совпадение групп: 0.09615384615384616
Частичное совпадение групп: 0.75
Время выполнения: 00:10 | в миллисекундах: 10.79726s (10797 ms)
```

---

- **ORB + ResNet + K-Means**

Для проверки гипотезы о том, что использование нескольких типов признаков улучшит качество кластеризации, были подмешаны признаки ORB к эмбеддингам ResNet50, далее применялась кластеризация.

Результаты:
- Точное совпадение групп — 0.0769
- Время выполнения — 00:17 (17.57530s)

```
-------------------6. Кластеризация с помощью K-Means и ORB + ResNet-------------------
Количество групп: 52
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 15/15 [00:05<00:00,  2.87it/s]
Извлечение признаков ORB: 100%|█████████████████████████████| 456/456 [00:08<00:00, 53.32it/s]
Совпавшие группы: 
Точное совпадение групп: 0.0
Частичное совпадение групп: 0.07692307692307693
Время выполнения: 00:17 | в миллисекундах: 17.57530s (17575 ms)
```

---

- **ResNet + Agglomerative Clustering**

Результаты:
- Точное совпадение групп — 0.0962 / 0.0192 (linkage='ward' / 'average')
- Время выполнения — 00:07 (7.88412s) / 00:07 (7.26284s)

```
-------------------7. Кластеризация с помощью Agglomerative Clustering и ResNet-------------------
Количество групп: 52
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 15/15 [00:07<00:00,  2.03it/s]
Совпавшие группы: 
{'000468.jpg', '000360.jpg', '000239.jpg', '000580.jpg', '000558.jpg', '000223.jpg', '000408.jpg', '000457.jpg', '000048.jpg', '000439.jpg', '000172.jpg', '000333.jpg', '000480.jpg', '000325.jpg'}
{'000007.jpg', '000413.jpg', '000399.jpg', '000498.jpg', '000539.jpg', '000288.jpg', '000091.jpg', '000050.jpg', '000517.jpg', '000215.jpg', '000500.jpg', '000240.jpg', '000267.jpg', '000420.jpg', '000306.jpg', '000512.jpg'}
{'000123.jpg', '000436.jpg', '000357.jpg', '000147.jpg', '000350.jpg', '000450.jpg', '000077.jpg'}
{'000365.jpg', '000218.jpg', '000318.jpg'}
{'000100.jpg', '000150.jpg', '000272.jpg', '000423.jpg', '000245.jpg'}
Точное совпадение групп: 0.09615384615384616
Частичное совпадение групп: 0.75
Время выполнения: 00:07 | в миллисекундах: 7.88412s (7884 ms)
```

```
-------------------8. Кластеризация с помощью Agglomerative Clustering (average linkage) и ResNet-------------------
Количество групп: 52
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 15/15 [00:06<00:00,  2.22it/s]
Совпавшие группы: 
{'000100.jpg', '000150.jpg', '000272.jpg', '000423.jpg', '000245.jpg'}
Точное совпадение групп: 0.019230769230769232
Частичное совпадение групп: 0.7307692307692307
Время выполнения: 00:07 | в миллисекундах: 7.26284s (7262 ms)
```

---

### **Замеры времени на данных data**

🏆 Лучшими 🏆 методами оказались:

- **ResNet + K-Means**
- **ResNet + Agglomerative Clustering с linkage='ward'**

Количество кластеров на закрытых данных указывалось равным количеству групп в ground truth.

Время выполнения ResNet + K-Means — 00.14 (14.17817s)

Время выполнения ResNet + Agglomerative Clustering — 00.12 (12.43199s)

```
-------------------Кластеризация с помощью K-Means и ResNet-------------------
Извлечение признаков ResNet для 827 изображений...
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 26/26 [00:11<00:00,  2.22it/s]
Время выполнения: 00:14 | в миллисекундах: 14.17817s (14178 ms)

-------------------Кластеризация с помощью Agglomerative Clustering и ResNet-------------------
Извлечение признаков ResNet для 827 изображений...
Извлечение признаков ResNet-50: 100%|█████████████████████████████| 26/26 [00:11<00:00,  2.21it/s]
Время выполнения: 00:12 | в миллисекундах: 12.43199s (12431 ms)
```